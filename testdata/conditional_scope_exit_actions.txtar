Conditional block with action nodes that exits parent list scope.

-- values.yaml --
tls:
  enabled: true
  port: 443
-- input.yaml --
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - name: test
    args:
    {{- if .Values.tls.enabled }}
      - {{ .Values.tls.port }}
    ports:
      - containerPort: {{ .Values.tls.port }}
        name: https
    {{- else }}
      - "8080"
    ports:
      - containerPort: 8080
        name: http
    {{- end }}
-- helm_output.yaml --
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - name: test
    args:
      - 443
    ports:
      - containerPort: 443
        name: https
-- output.cue --
import "struct"

#values: {
	tls?: {
		enabled?: bool | number | string | null
		port!:    bool | number | string | null
		...
	}
	...
}

output: [
	{
		apiVersion: "v1"
		kind:       "Pod"
		metadata: name: "test"
		spec: containers: [
			{
				name: "test"
				args: [
					if (_nonzero & {#arg: #values.tls.enabled, _}) {
						#values.tls.port
					},
					if !(_nonzero & {#arg: #values.tls.enabled, _}) {
						"8080"
					},
				]
				if (_nonzero & {#arg: #values.tls.enabled, _}) {
					ports: [
						{
							containerPort: #values.tls.port
							name:          "https"
						},
					]
				}
				if !(_nonzero & {#arg: #values.tls.enabled, _}) {
					ports: [
						{
							containerPort: 8080
							name:          "http"
						},
					]
				}
			},
		]
	},
]
_nonzero: {
	#arg?: _
	[if #arg != _|_ {
		[
			if (#arg & int) != _|_ {#arg != 0},
			if (#arg & string) != _|_ {#arg != ""},
			if (#arg & float) != _|_ {#arg != 0.0},
			if (#arg & bool) != _|_ {#arg},
			if (#arg & [...]) != _|_ {len(#arg) > 0},
			if (#arg & {...}) != _|_ {(#arg & struct.MaxFields(0)) == _|_},
			false,
		][0]
	}, false][0]
}
