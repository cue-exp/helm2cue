# Chart with list-valued fields in values.yaml accessed only via
# truthiness checks (if .Values.volumes). The inferred schema
# types these as scalars, conflicting with the [] value.
# https://github.com/cue-exp/helm2cue/issues/41
exec helm2cue chart chartdir outdir
stderr 'values.yaml does not satisfy inferred schema'
stderr 'converted 1/1 templates'
cmp outdir/values.cue expected/values.cue

-- chartdir/Chart.yaml --
apiVersion: v2
name: test-app
version: 0.1.0
-- chartdir/values.yaml --
volumes: []
sidecars: []
-- chartdir/templates/test.yaml --
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - name: app
    image: test
    {{- if .Values.volumes }}
    volumeMounts:
    - name: data
      mountPath: /data
    {{- end }}
  {{- if .Values.sidecars }}
  restartPolicy: Always
  {{- end }}
-- stderr.golden --
-- expected/values.cue --
// Code generated by helm2cue; DO NOT EDIT.

package test_app

#values: {
	volumes?:  bool | number | string | null
	sidecars?: bool | number | string | null
	...
}
